# Event Sourcing & n8n POC

This is a Proof of Concept (POC) for an event-sourced booking system using **Symfony 6.4**, **API Platform 3.4**, **React 18 (Vite)**, and **n8n**.

## ğŸš€ Quick Start

To initialize the entire system from scratch (containers, database, dependencies, and test data):

```bash
make init
```

## ğŸŒ Service URLs

### ğŸ–¥ï¸ Frontend
*   **Main Entry Point (via Symfony):** [http://localhost:8080/](http://localhost:8080/)
*   **Vite Dev Server (Direct):** [http://localhost:5173/](http://localhost:5173/)
*   **Data Explorer:** [http://localhost:8080/explorer](http://localhost:8080/explorer) (Visual inspection of all models)

### ğŸ”Œ API & Documentation
*   **Swagger UI (API Docs):** [http://localhost:8080/docs](http://localhost:8080/docs)
*   **Alternative Swagger Link:** [http://localhost:8080/swagger](http://localhost:8080/swagger)

#### Core Endpoints
*   **Users:** `GET/POST http://localhost:8080/api/users`
*   **Suppliers:** `GET/POST http://localhost:8080/api/suppliers`
*   **Products (Menus):** `GET/POST http://localhost:8080/api/products`
*   **Event Store:** `GET http://localhost:8080/api/event-store`
*   **Booking Wizard:** `POST http://localhost:8080/api/booking-wizard`

### âš™ï¸ Automation & Tools
*   **n8n Workflow Tool:** [http://localhost:5678/](http://localhost:5678/)
*   **Adminer (Database Management):** [http://localhost:8081/](http://localhost:8081/)

#### ğŸ—„ï¸ Dev Database Credentials (Adminer)
*   **System:** `PostgreSQL`
*   **Server:** `postgres-db`
*   **Username:** `user`
*   **Password:** `password`
*   **Database:** `event_sourcing_dev`

## ğŸ—ï¸ Architecture Features
*   **DDD (Domain-Driven Design):** Strict separation of layers (Domain, Application, Infrastructure).
*   **CQRS:** Separation of Read (DBAL/SQL) and Write (ORM) responsibilities.
*   **Client-Side Identity:** UUID v7/v4 generated by the frontend to ensure strict idempotency and prevent duplicate processing.
*   **Event Sourcing:** The `event_store` table is the absolute Source of Truth. All state is derived from events.
*   **Black-Box Testing:** Functional tests verify the system via API endpoints instead of DB queries, ensuring the system is tested as a real consumer.
*   **Observability:** Integrated Data Explorer to inspect events and projections in real-time.

## ğŸ› ï¸ Advanced Commands

### ğŸ”„ Rebuilding Projections (Disaster Recovery)
If the read models (tables like `users` or `bookings`) are lost or corrupted, they can be fully restored by replaying all historical events:

```bash
docker compose exec symfony-api bin/console app:projections:rebuild
```

### ğŸ§ª Running Tests
```bash
make test
```
