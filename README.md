# Event Sourcing & n8n POC

This is a Proof of Concept (POC) for an event-sourced booking system using **Symfony 6.4**, **API Platform 3.4**, **React 18 (Vite)**, and **n8n**.

## üöÄ Quick Start

To initialize the entire system from scratch (containers, database, dependencies, and test data):

```bash
make init
```

## üåê Service URLs

### üñ•Ô∏è Frontend
*   **TED Demo Mode:** [http://localhost:8080/demo](http://localhost:8080/demo) (Recommended for presentation)
*   **Main Entry Point:** [http://localhost:8080/](http://localhost:8080/)
*   **Data Explorer:** [http://localhost:8080/explorer](http://localhost:8080/explorer)

### üîå API & Documentation
*   **Swagger UI (API Docs):** [http://localhost:8080/docs](http://localhost:8080/docs)

#### Core Endpoints
*   **Event Store (Mongo):** `GET http://localhost:8080/api/event-store`
*   **Projections (Postgres):** `GET http://localhost:8080/api/users`, `GET http://localhost:8080/api/bookings`
*   **Checkpoints (Mongo):** `GET http://localhost:8080/api/checkpoints`

### ‚öôÔ∏è Automation & Tools
*   **n8n Workflow Tool:** [http://localhost:5678/](http://localhost:5678/)
*   **Adminer (Postgres Mgmt):** [http://localhost:8081/](http://localhost:8081/)
*   **Mongo Express (Mongo Mgmt):** [http://localhost:8082/](http://localhost:8082/)

#### üîÑ Importing n8n Workflow
To visualize the automation flow:
1.  Open n8n at [http://localhost:5678/](http://localhost:5678/).
2.  Create a new workflow.
3.  Click on the top-right menu (three dots) and select **"Import from File"**.
4.  Select the `n8n_workflow.json` file located in the root of this project.

#### üóÑÔ∏è Dev Database Credentials (Adminer)
*   **System:** `PostgreSQL`
*   **Server:** `postgres-db`
*   **Username:** `user`
*   **Password:** `password`
*   **Database:** `event_sourcing_dev`

#### üçÉ Dev Database Credentials (Mongo Express)
*   **Login User:** `user` (Web Auth)
*   **Login Password:** `password` (Web Auth)
*   **Server:** `mongodb`
*   **DB Username:** `root`
*   **DB Password:** `password`

## üèóÔ∏è Architecture: Enterprise-Grade Hybrid
*   **DDD (Domain-Driven Design):** Strict separation of layers (Domain, Application, Infrastructure).
*   **Source of Truth (Write Side):** **MongoDB** storing immutable `StoredEvent` objects.
*   **Read Models (Read Side):** **PostgreSQL** storing optimized SQL tables for the UI.
*   **CQRS:** Separation of Read (DBAL/SQL) and Write (ORM) responsibilities.
*   **Checkpoints & Snapshots:** Managed in MongoDB to decouple technical state from business data.
*   **Client-Side Identity:** UUID v7 (time-ordered) generated by the frontend for idempotency.
*   **Automatic Snapshots:** Triggered every $N$ events (configurable in `.env`).
*   **Observability:** Integrated Data Explorer and Demo Flow monitor.

## üõ†Ô∏è Advanced Commands

### üîÑ Rebuilding Projections (Disaster Recovery)
If Postgres data is lost, it can be fully restored by replaying history from MongoDB:

```bash
docker compose exec symfony-api bin/console app:projections:rebuild
```

### üß™ Running Tests
```bash
make test
```
